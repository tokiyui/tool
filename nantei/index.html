<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>南岸低気圧事例</title>
<style>
  body { font-family: sans-serif; padding: 0px; }
  select, img { margin: 5px; }
  .tenkizu img { width: 300px; margin-right: 5px; }
  .emagram img { width: 300px; margin-right: 5px; }
  .analysis {
    display: flex;
    flex-wrap: wrap;  
    gap: 5px;     
  }
  .analysis img { width: 500px; } 
</style>
</head>
<body>

<h2>事例選択：
<select id="caseSelect">
  <option value="2013011312|20130114">20130114</option>
  <option value="2014020712|20140208">20140208</option>
  <option value="2014021312|20140214">20140214</option>
  <option value="2016011700|20160118">20160118</option>
  <option value="2018012112|20180122">20180122</option>
  <option value="2020032800|20200329">20200329</option>
  <option value="2022010512|20220106">20220106</option>
  <option value="2022020912|20220210">20220210</option>
  <option value="2023020912|20230210">20230210</option>
  <option value="2024020412|20240205">20240205</option>
</select>
</h2>

<div class="tenkizu" id="tenkizu"></div>
<div class="emagram" id="emagram"></div>
  
<h3>MSM各層解析値（黄色は湿球温度0度）：
<select id="analysisTime"></select>
<div class="analysis" id="analysis"></div>
</h3>
  
<script>
// 解析図タイプ
const analysisTypes = ["850","925","950","975","pres","surf"];

// 天気図表示関数
function showTenkizu(init, caseDate) {
  const hour = parseInt(init.slice(8,10));
  const container = document.getElementById("tenkizu");
  container.innerHTML = "";
  for(let i=0; i<5; i++){
    let h = (hour + i*12) % 24;
    let d = new Date(
      parseInt(init.slice(0,4)),
      parseInt(init.slice(4,6))-1,
      parseInt(init.slice(6,8))
    );
    // 日跨ぎ補正
    d.setDate(d.getDate() + Math.floor((hour + i*12)/24));
    const yyyy = d.getFullYear();
    const mm = String(d.getMonth()+1).padStart(2,"0");
    const dd = String(d.getDate()).padStart(2,"0");
    const hh = String(h).padStart(2,"0");
    const imgPath = `./tenkizu/${caseDate}/${yyyy}${mm}${dd}${hh}.jpg`;
    const img = document.createElement("img");
    img.src = imgPath;
    container.appendChild(img);
  }
}

// エマグラム表示関数
function showEmagram(init, caseDate) {
  const hour = parseInt(init.slice(8,10));
  const container = document.getElementById("emagram");
  container.innerHTML = "";
  for(let i=0; i<5; i++){
    let h = (hour + i*12) % 24;
    let d = new Date(
      parseInt(init.slice(0,4)),
      parseInt(init.slice(4,6))-1,
      parseInt(init.slice(6,8))
    );
    // 日跨ぎ補正
    d.setDate(d.getDate() + Math.floor((hour + i*12)/24));
    const yyyy = d.getFullYear();
    const mm = String(d.getMonth()+1).padStart(2,"0");
    const dd = String(d.getDate()).padStart(2,"0");
    const hh = String(h).padStart(2,"0");
    const imgPath = `./emagram/${caseDate}/47646_${yyyy}${mm}${dd}${hh}.jpg`;
    const img = document.createElement("img");
    img.src = imgPath;
    container.appendChild(img);
  }
}

// 解析図プルダウン作成
function createAnalysisTime(init){
  const container = document.getElementById("analysisTime");
  container.innerHTML = "";
  const initDate = new Date(
    parseInt(init.slice(0,4)),
    parseInt(init.slice(4,6))-1,
    parseInt(init.slice(6,8)),
    parseInt(init.slice(8,10))
  );
  for(let i=0; i<=16; i++){ // 3h刻み48h分
    const d = new Date(initDate.getTime() + i*3*3600*1000);
    const yyyy = d.getFullYear();
    const mm = String(d.getMonth()+1).padStart(2,"0");
    const dd = String(d.getDate()).padStart(2,"0");
    const hh = String(d.getHours()).padStart(2,"0");
    const value = `${yyyy}${mm}${dd}${hh}`;
    const option = document.createElement("option");
    option.value = value;
    option.textContent = `${yyyy}${mm}${dd} ${hh}Z`;
    container.appendChild(option);
  }
}

// 解析図表示
function showAnalysis(time, caseDate){
  const container = document.getElementById("analysis");
  container.innerHTML = "";
  analysisTypes.forEach(type=>{
    const img = document.createElement("img");
    img.src = `./analysis/${caseDate}/${time}_${type}.png`;
    container.appendChild(img);
  });
}

// 事例変更時
document.getElementById("caseSelect").addEventListener("change", e=>{
  const [init, caseDate] = e.target.value.split("|");
  showTenkizu(init, caseDate);
  showEmagram(init, caseDate);
  createAnalysisTime(init);
  showAnalysis(init, caseDate);
});

// 解析図時刻変更
document.getElementById("analysisTime").addEventListener("change", e=>{
  const caseDate = document.getElementById("caseSelect").value.split("|")[1];
  showAnalysis(e.target.value, caseDate);
});

// 十字キーで解析図操作
document.addEventListener("keydown", e=>{
  const sel = document.getElementById("analysisTime");
  let idx = sel.selectedIndex;
  if(e.key === "ArrowRight" && idx < sel.options.length-1){
    sel.selectedIndex = idx+1;
    const caseDate = document.getElementById("caseSelect").value.split("|")[1];
    showAnalysis(sel.value, caseDate);
  } else if(e.key === "ArrowLeft" && idx>0){
    sel.selectedIndex = idx-1;
    const caseDate = document.getElementById("caseSelect").value.split("|")[1];
    showAnalysis(sel.value, caseDate);
  }
});

// 初期表示
const [init, caseDate] = document.getElementById("caseSelect").value.split("|");
showTenkizu(init, caseDate);
showEmagram(init, caseDate);
createAnalysisTime(init);
showAnalysis(init, caseDate);

</script>
</body>
</html>
